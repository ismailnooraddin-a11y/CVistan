// prisma/schema.prisma
// Database schema for CV Maker application
// Supports: PostgreSQL (Vercel Postgres, Supabase, Neon, etc.)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL") // For migrations on serverless
}

// ==================== USER MODEL ====================
model User {
  id            String   @id @default(cuid())
  email         String   @unique
  phone         String?
  fullName      String
  passwordHash  String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  cvs           CV[]
  
  @@index([email])
}

// ==================== CV MODEL ====================
model CV {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Template selection
  templateId  String   @default("modern")
  language    String   @default("en") // en, ar, ku
  
  // CV Data stored as JSON
  data        Json     // Full CV data object
  
  // Metadata
  title       String   @default("My CV")
  isPublic    Boolean  @default(false)
  publicSlug  String?  @unique
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([userId])
  @@index([publicSlug])
}

// ==================== ANALYTICS (Optional) ====================
model CVView {
  id        String   @id @default(cuid())
  cvId      String
  viewerIp  String?
  userAgent String?
  viewedAt  DateTime @default(now())
  
  @@index([cvId])
  @@index([viewedAt])
}
